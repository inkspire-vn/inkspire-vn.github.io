<!DOCTYPE html>
<html lang="vi" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev - InkSpire</title>

  <link rel="icon" type="image/png" href="https://avatars.githubusercontent.com/u/254457838?s=64">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Password screen -->
<div id="password-screen" class="d-flex align-items-center justify-content-center vh-100 bg-light">
  <div class="card p-5 shadow-lg" style="max-width: 420px; width: 100%;">
    <h3 class="text-center mb-4">Dev Access</h3>
    <p class="text-center text-muted mb-4">Nháº­p máº­t kháº©u Ä‘á»ƒ vÃ o khu vá»±c quáº£n lÃ½</p>
    
    <input type="password" id="devPassword" class="form-control mb-3" placeholder="Máº­t kháº©u..." autocomplete="off">
    <button id="submitPassword" class="btn btn-primary w-100">VÃ o</button>
    
    <p id="errorMsg" class="text-danger text-center mt-3 d-none">Sai máº­t kháº©u!</p>
  </div>
</div>

<!-- Real content (hidden until password correct) -->
<div id="dev-content" class="d-none">
  <nav class="navbar navbar-expand-lg sticky-top shadow">
    <div class="container">
      <a class="navbar-brand fw-bold fs-4" href="https://inkspire-vn.github.io">InkSpire</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="https://inkspire-vn.github.io">Trang chá»§</a></li>
          <li class="nav-item"><a class="nav-link" href="/products">Sáº£n pháº©m</a></li>
          <li class="nav-item"><a class="nav-link" href="/events">Sá»± kiá»‡n</a></li>
          <li class="nav-item"><a class="nav-link" href="/contact">LiÃªn há»‡</a></li>
        </ul>

        <div class="d-flex align-items-center gap-4">
          <div class="lang-group" id="langGroup" role="button" tabindex="0">
            <span class="flag vi-flag" data-lang="vi">ğŸ‡»ğŸ‡³</span>
            <div class="switch">
              <input type="checkbox" id="langSwitch">
              <span class="slider"></span>
            </div>
            <span class="flag en-flag" data-lang="en">ğŸ‡ºğŸ‡¸</span>
          </div>
          <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
        </div>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <h1 class="text-center mb-5">Dev Page - Quáº£n lÃ½ Sáº£n pháº©m & Sá»± kiá»‡n</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="devTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab">Sáº£n pháº©m</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">Sá»± kiá»‡n</button>
      </li>
    </ul>

    <div class="tab-content" id="devTabContent">
      <!-- Products Tab -->
      <div class="tab-pane fade show active" id="products" role="tabpanel">
        <h3 class="mb-4">ThÃªm sáº£n pháº©m má»›i</h3>
        <form id="productForm" class="row g-3 mb-5">
          <div class="col-md-6">
            <label class="form-label">TÃªn sáº£n pháº©m</label>
            <input type="text" class="form-control" id="productName" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">GiÃ¡ (vÃ­ dá»¥: 220k â‚«)</label>
            <input type="text" class="form-control" id="productPrice" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Danh má»¥c</label>
            <select class="form-select" id="productCategory" required>
              <option value="Books">SÃ¡ch â€“ Books</option>
              <option value="Stationery">VÄƒn phÃ²ng pháº©m â€“ Stationery</option>
              <option value="Toys">Äá»“ chÆ¡i â€“ Toys</option>
            </select>
          </div>
          <div class="col-12">
            <label class="form-label">Link áº£nh (URL)</label>
            <input type="url" class="form-control" id="productImage" placeholder="https://example.com/image.jpg" required>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">ThÃªm sáº£n pháº©m</button>
          </div>
        </form>

        <h4 class="mt-5 mb-3">Sáº£n pháº©m hiá»‡n táº¡i</h4>
        <div id="productList" class="list-group"></div>
      </div>

      <!-- Events Tab (basic â€“ expand later if needed) -->
      <div class="tab-pane fade" id="events" role="tabpanel">
        <h3 class="mb-4">ThÃªm sá»± kiá»‡n má»›i</h3>
        <form id="eventForm" class="row g-3 mb-5">
          <div class="col-md-6">
            <label class="form-label">TiÃªu Ä‘á» sá»± kiá»‡n</label>
            <input type="text" class="form-control" id="eventTitle" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">NgÃ y & giá»</label>
            <input type="text" class="form-control" id="eventDate" placeholder="January 20, 2026 | 2:00 PM" required>
          </div>
          <div class="col-12">
            <label class="form-label">MÃ´ táº£</label>
            <textarea class="form-control" id="eventDesc" rows="3" required></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Link áº£nh (URL) â€“ optional</label>
            <input type="url" class="form-control" id="eventImage" placeholder="https://example.com/event.jpg">
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">ThÃªm sá»± kiá»‡n</button>
          </div>
        </form>

        <h4 class="mt-5 mb-3">Sá»± kiá»‡n hiá»‡n táº¡i</h4>
        <div id="eventList" class="list-group"></div>
      </div>
    </div>

    <div class="text-center mt-5">
      <a href="https://inkspire-vn.github.io" class="btn btn-outline-secondary btn-lg">â† Quay vá» Trang chá»§</a>
    </div>
  </main>

  <footer class="text-center py-4" style="background:var(--bs-primary); color:white;">
    <div class="container">
      <p class="mb-1">Â© 2026 InkSpire Bookstore â€¢ TP. Há»“ ChÃ­ Minh</p>
      <small>Tri thá»©c báº¯t Ä‘áº§u tá»« má»™t giá»t má»±c</small>
    </div>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // UTF-8 safe base64 helpers
function utf8ToBase64(str) {
  return btoa(unescape(encodeURIComponent(str)));
}

function base64ToUtf8(str) {
  return decodeURIComponent(escape(atob(str)));
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Password protection
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const PASSWORD = "inkspire@2025";
const passwordScreen = document.getElementById("password-screen");
const devContent = document.getElementById("dev-content");
const passwordInput = document.getElementById("devPassword");
const submitBtn = document.getElementById("submitPassword");
const errorMsg = document.getElementById("errorMsg");

submitBtn.addEventListener("click", () => {
  if (passwordInput.value === PASSWORD) {
    passwordScreen.classList.add("d-none");
    devContent.classList.remove("d-none");
    loadAllData(); // Load after successful login
  } else {
    errorMsg.classList.remove("d-none");
    passwordInput.value = "";
    passwordInput.focus();
  }
});

passwordInput.addEventListener("keypress", e => {
  if (e.key === "Enter") submitBtn.click();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GitHub API Config
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// token removed for safety GITHUB
const REPO_OWNER = "inkspire-vn";
const REPO_NAME = "inkspire-vn.github.io";
const PRODUCTS_FILE = "data/products.json";
const EVENTS_FILE = "data/events.json";

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Products Management
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let currentProducts = [];

async function loadProducts() {
  try {
    const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${PRODUCTS_FILE}`, {
      headers: {
        'Accept': 'application/vnd.github.v3+json',
        'Authorization': `token ${GITHUB_TOKEN}`
      }
    });
    if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);
    const data = await res.json();
    const content = atob(data.content);
    currentProducts = JSON.parse(content);
    renderProductList();
  } catch (err) {
    console.error(err);
    alert('KhÃ´ng thá»ƒ táº£i sáº£n pháº©m tá»« GitHub. Kiá»ƒm tra token hoáº·c file data/products.json cÃ³ tá»“n táº¡i chÆ°a.');
  }
}

function renderProductList() {
  const list = document.getElementById('productList');
  list.innerHTML = '';

  if (currentProducts.length === 0) {
    list.innerHTML = '<p class="text-muted text-center py-4">ChÆ°a cÃ³ sáº£n pháº©m nÃ o.</p>';
    return;
  }

  currentProducts.forEach((p, index) => {
    const item = document.createElement('div');
    item.className = 'list-group-item d-flex justify-content-between align-items-center';
    item.innerHTML = `
      <div>
        <strong>${p.name}</strong> â€” ${p.price} (${p.category})<br>
        <small class="text-muted">${p.image.substring(0, 60)}${p.image.length > 60 ? '...' : ''}</small>
      </div>
      <button class="btn btn-danger btn-sm" onclick="deleteProduct(${index})">
        <i class="fas fa-trash"></i> XÃ³a
      </button>
    `;
    list.appendChild(item);
  });
}

async function deleteProduct(index) {
  if (!confirm('Báº¡n cháº¯c cháº¯n muá»‘n xÃ³a sáº£n pháº©m nÃ y?')) return;

  currentProducts.splice(index, 1);
  await saveToGitHub(PRODUCTS_FILE, currentProducts);
  renderProductList();
  alert('ÄÃ£ xÃ³a vÃ  cáº­p nháº­t lÃªn GitHub!');
}

document.getElementById('productForm').addEventListener('submit', async e => {
  e.preventDefault();

  const name = document.getElementById('productName').value.trim();
  const price = document.getElementById('productPrice').value.trim();
  const category = document.getElementById('productCategory').value;
  const image = document.getElementById('productImage').value.trim();

  if (!name || !price || !category || !image) {
    alert('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
    return;
  }

  currentProducts.push({ name, price, category, image });
  await saveToGitHub(PRODUCTS_FILE, currentProducts);
  renderProductList();

  e.target.reset();
  alert('ÄÃ£ thÃªm sáº£n pháº©m vÃ  cáº­p nháº­t lÃªn GitHub!');
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Events Management (basic â€“ same pattern)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let currentEvents = [];

async function loadEvents() {
  try {
    const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${EVENTS_FILE}`, {
      headers: {
        'Accept': 'application/vnd.github.v3+json',
        'Authorization': `token ${GITHUB_TOKEN}`
      }
    });
    if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);
    const data = await res.json();
    const content = atob(data.content);
    currentEvents = JSON.parse(content);
    renderEventList();
  } catch (err) {
    console.error(err);
    alert('KhÃ´ng thá»ƒ táº£i sá»± kiá»‡n tá»« GitHub. Táº¡o file data/events.json náº¿u chÆ°a cÃ³.');
  }
}

function renderEventList() {
  const list = document.getElementById('eventList');
  list.innerHTML = '';

  if (currentEvents.length === 0) {
    list.innerHTML = '<p class="text-muted text-center py-4">ChÆ°a cÃ³ sá»± kiá»‡n nÃ o.</p>';
    return;
  }

  currentEvents.forEach((e, index) => {
    const item = document.createElement('div');
    item.className = 'list-group-item d-flex justify-content-between align-items-center';
    item.innerHTML = `
      <div>
        <strong>${e.title}</strong> â€” ${e.date}<br>
        <small class="text-muted">${e.desc.substring(0, 80)}${e.desc.length > 80 ? '...' : ''}</small>
      </div>
      <button class="btn btn-danger btn-sm" onclick="deleteEvent(${index})">
        <i class="fas fa-trash"></i> XÃ³a
      </button>
    `;
    list.appendChild(item);
  });
}

async function deleteEvent(index) {
  if (!confirm('Báº¡n cháº¯c cháº¯n muá»‘n xÃ³a sá»± kiá»‡n nÃ y?')) return;

  currentEvents.splice(index, 1);
  await saveToGitHub(EVENTS_FILE, currentEvents);
  renderEventList();
  alert('ÄÃ£ xÃ³a vÃ  cáº­p nháº­t lÃªn GitHub!');
}

document.getElementById('eventForm').addEventListener('submit', async e => {
  e.preventDefault();

  const title = document.getElementById('eventTitle').value.trim();
  const date = document.getElementById('eventDate').value.trim();
  const desc = document.getElementById('eventDesc').value.trim();
  const image = document.getElementById('eventImage').value.trim() || '';

  if (!title || !date || !desc) {
    alert('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin báº¯t buá»™c!');
    return;
  }

  currentEvents.push({ title, date, desc, image });
  await saveToGitHub(EVENTS_FILE, currentEvents);
  renderEventList();

  e.target.reset();
  alert('ÄÃ£ thÃªm sá»± kiá»‡n vÃ  cáº­p nháº­t lÃªn GitHub!');
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Core GitHub API save function (used by both products & events)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function saveToGitHub(filePath, data) {
  try {
    // Get current file info (SHA required for update)
    const getRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`, {
      headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
    });
    if (!getRes.ok) throw new Error(`Cannot read file: ${getRes.status}`);
    const fileInfo = await getRes.json();
    const sha = fileInfo.sha;

    // Encode new content
    const content = btoa(JSON.stringify(data, null, 2));

    // Push update
    const updateRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`, {
      method: 'PUT',
      headers: { 'Authorization': `token ${GITHUB_TOKEN}` },
      body: JSON.stringify({
        message: `Update ${filePath.split('/').pop()} from dev page (${new Date().toISOString()})`,
        content: content,
        sha: sha
      })
    });

    if (!updateRes.ok) {
      const errData = await updateRes.json();
      throw new Error(errData.message || 'Update failed');
    }

    console.log(`Successfully updated ${filePath}`);
  } catch (err) {
    console.error('GitHub save error:', err);
    alert('Lá»—i khi lÆ°u lÃªn GitHub: ' + err.message + '\nKiá»ƒm tra token, quyá»n truy cáº­p, hoáº·c file cÃ³ tá»“n táº¡i chÆ°a.');
  }
}

// Load everything after password success
function loadAllData() {
  loadProducts();
  loadEvents();
}

// Theme & Language (copy from your other pages)
const themeBtn = document.getElementById('themeBtn');
function setTheme(mode) {
  html.setAttribute('data-bs-theme', mode);
  localStorage.setItem('theme', mode);
  themeBtn.textContent = mode === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
}
setTheme(localStorage.getItem('theme') || 'light');
themeBtn.onclick = () => setTheme(html.getAttribute('data-bs-theme') === 'light' ? 'dark' : 'light');

const langGroup = document.getElementById('langGroup');
const langSwitch = document.getElementById('langSwitch');

const dict = {
  vi: {
    home: "Trang chá»§",
    products: "Sáº£n pháº©m",
    events: "Sá»± kiá»‡n",
    contact: "LiÃªn há»‡",
    "dev-title": "Dev Page - Quáº£n lÃ½ Sáº£n pháº©m & Sá»± kiá»‡n",
    footer: "Tri thá»©c báº¯t Ä‘áº§u tá»« má»™t giá»t má»±c"
  },
  en: {
    home: "Home",
    products: "Products",
    events: "Events",
    contact: "Contact",
    "dev-title": "Dev Page - Manage Products & Events",
    footer: "Knowledge begins with a drop of ink"
  }
};

function setLang(lang) {
  html.lang = lang;
  localStorage.setItem('lang', lang);
  langSwitch.checked = (lang === 'en');

  document.querySelector('.vi-flag').classList.toggle('inactive', lang !== 'vi');
  document.querySelector('.en-flag').classList.toggle('inactive', lang !== 'en');

  document.querySelectorAll('[data-lang-key]').forEach(el => {
    const k = el.getAttribute('data-lang-key');
    if (dict[lang][k]) el.textContent = dict[lang][k];
  });
}

setLang(localStorage.getItem('lang') || 'vi');

langGroup.addEventListener('click', () => {
  const cur = localStorage.getItem('lang') || 'vi';
  setLang(cur === 'vi' ? 'en' : 'vi');
});

langSwitch.addEventListener('change', () => {
  setLang(langSwitch.checked ? 'en' : 'vi');
});
</script>
</body>
</html>
