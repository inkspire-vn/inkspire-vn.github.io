<!DOCTYPE html>
<html lang="vi" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev - InkSpire</title>

  <link rel="icon" type="image/png" href="https://avatars.githubusercontent.com/u/254457838?s=64">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9XvWCZOyaSuT42HBMUgQQ7KTuQYPWLbE",
      authDomain: "inkspire-vn-security.firebaseapp.com",
      databaseURL: "https://inkspire-vn-security-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "inkspire-vn-security",
      storageBucket: "inkspire-vn-security.firebasestorage.app",
      messagingSenderId: "774834040534",
      appId: "1:774834040534:web:c7b5e64826176a44b4e377",
      measurementId: "G-MJSRBE9TY6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    window.db = db;
    window.auth = auth;
    window.provider = provider;
    window.signInWithPopup = signInWithPopup;
    window.onAuthStateChanged = onAuthStateChanged;
    window.signOut = signOut;
    window.ref = ref;
    window.onValue = onValue;
    window.push = push;
    window.remove = remove;
  </script>
</head>
<body>

<!-- Google Login Screen (staff only) -->
<div id="login-screen" class="d-flex align-items-center justify-content-center vh-100 bg-light">
  <div class="card p-5 shadow-lg text-center" style="max-width: 420px;">
    <h3>Dev Access - Staff Only</h3>
    <p class="text-muted mb-4">ƒêƒÉng nh·∫≠p b·∫±ng Google ƒë·ªÉ qu·∫£n l√Ω</p>
    <button id="googleSignIn" class="btn btn-outline-danger btn-lg w-100 mb-3">
      <i class="fab fa-google me-2"></i> ƒêƒÉng nh·∫≠p b·∫±ng Google
    </button>
    <p id="loginError" class="text-danger d-none">ƒêƒÉng nh·∫≠p th·∫•t b·∫°i ho·∫∑c kh√¥ng ƒë∆∞·ª£c ph√©p.</p>
  </div>
</div>

<!-- Main content (hidden until logged in) -->
<div id="dev-content" class="d-none">
  <nav class="navbar navbar-expand-lg sticky-top shadow">
    <div class="container">
      <a class="navbar-brand fw-bold fs-4" href="https://inkspire-vn.github.io">InkSpire</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="https://inkspire-vn.github.io">Trang ch·ªß</a></li>
          <li class="nav-item"><a class="nav-link" href="/products">S·∫£n ph·∫©m</a></li>
          <li class="nav-item"><a class="nav-link" href="/events">S·ª± ki·ªán</a></li>
          <li class="nav-item"><a class="nav-link" href="/contact">Li√™n h·ªá</a></li>
        </ul>

        <div class="d-flex align-items-center gap-4">
          <div class="lang-group" id="langGroup" role="button" tabindex="0">
            <span class="flag vi-flag" data-lang="vi">üáªüá≥</span>
            <div class="switch">
              <input type="checkbox" id="langSwitch">
              <span class="slider"></span>
            </div>
            <span class="flag en-flag" data-lang="en">üá∫üá∏</span>
          </div>
          <button class="theme-btn" id="themeBtn">üåô</button>
          <button id="signOutBtn" class="btn btn-sm btn-outline-danger">ƒêƒÉng xu·∫•t</button>
        </div>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <h1 class="text-center mb-5">Dev Page - Qu·∫£n l√Ω S·∫£n ph·∫©m & S·ª± ki·ªán</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="devTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab">S·∫£n ph·∫©m</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">S·ª± ki·ªán</button>
      </li>
    </ul>

    <div class="tab-content" id="devTabContent">
      <div class="tab-pane fade show active" id="products" role="tabpanel">
        <h3 class="mb-4">Th√™m s·∫£n ph·∫©m m·ªõi</h3>
        <form id="productForm" class="row g-3 mb-5">
          <div class="col-md-6">
            <label class="form-label">T√™n s·∫£n ph·∫©m</label>
            <input type="text" class="form-control" id="productName" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Gi√° (v√≠ d·ª•: 220k)</label>
            <input type="text" class="form-control" id="productPrice" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Danh m·ª•c</label>
            <select class="form-select" id="productCategory" required>
              <option value="Books">S√°ch ‚Äì Books</option>
              <option value="Stationery">VƒÉn ph√≤ng ph·∫©m ‚Äì Stationery</option>
              <option value="Toys">ƒê·ªì ch∆°i ‚Äì Toys</option>
            </select>
          </div>
          <div class="col-12">
            <label class="form-label">Link ·∫£nh (URL)</label>
            <input type="url" class="form-control" id="productImage" required>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Th√™m s·∫£n ph·∫©m</button>
          </div>
        </form>

        <h4 class="mt-5 mb-3">S·∫£n ph·∫©m hi·ªán t·∫°i</h4>
        <div id="productList" class="list-group"></div>
      </div>

      <div class="tab-pane fade" id="events" role="tabpanel">
        <h3 class="mb-4">Th√™m s·ª± ki·ªán m·ªõi</h3>
        <form id="eventForm" class="row g-3 mb-5">
          <div class="col-md-6">
            <label class="form-label">Ti√™u ƒë·ªÅ s·ª± ki·ªán</label>
            <input type="text" class="form-control" id="eventTitle" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Ng√†y & gi·ªù</label>
            <input type="text" class="form-control" id="eventDate" required>
          </div>
          <div class="col-12">
            <label class="form-label">M√¥ t·∫£</label>
            <textarea class="form-control" id="eventDesc" rows="3" required></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Link ·∫£nh (URL) ‚Äì optional</label>
            <input type="url" class="form-control" id="eventImage">
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Th√™m s·ª± ki·ªán</button>
          </div>
        </form>

        <h4 class="mt-5 mb-3">S·ª± ki·ªán hi·ªán t·∫°i</h4>
        <div id="eventList" class="list-group"></div>
      </div>
    </div>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
  // Firebase already initialized from head

  const loginScreen = document.getElementById('login-screen');
  const devContent = document.getElementById('dev-content');
  const googleSignIn = document.getElementById('googleSignIn');
  const signOutBtn = document.getElementById('signOutBtn');
  const loginError = document.getElementById('loginError');

  // Auth state listener
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginScreen.classList.add('d-none');
      devContent.classList.remove('d-none');
      loadAllData();
    } else {
      loginScreen.classList.remove('d-none');
      devContent.classList.add('d-none');
    }
  });

  googleSignIn.addEventListener('click', async () => {
    try {
      await signInWithPopup(auth, provider);
    } catch (error) {
      loginError.classList.remove('d-none');
      console.error('Login error:', error);
    }
  });

  signOutBtn.addEventListener('click', async () => {
    await signOut(auth);
  });

  // Load products & events real-time
  function loadAllData() {
    // Products
    onValue(ref(db, 'products'), (snapshot) => {
      const data = snapshot.val() || {};
      const products = Object.entries(data).map(([key, val]) => ({ key, ...val }));
      renderProducts(products);
    });

    // Events
    onValue(ref(db, 'events'), (snapshot) => {
      const data = snapshot.val() || {};
      const events = Object.entries(data).map(([key, val]) => ({ key, ...val }));
      renderEvents(events);
    });
  }

  function renderProducts(products) {
    const list = document.getElementById('productList');
    list.innerHTML = '';

    if (products.length === 0) {
      list.innerHTML = '<p class="text-muted text-center py-4">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</p>';
      return;
    }

    products.forEach(p => {
      const item = document.createElement('div');
      item.className = 'list-group-item d-flex justify-content-between align-items-center';
      item.innerHTML = `
        <div>
          <strong>${p.name}</strong> ‚Äî ${p.price} (${p.category})<br>
          <small class="text-muted">${p.image.substring(0, 60)}${p.image.length > 60 ? '...' : ''}</small>
        </div>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct('${p.key}')">
          <i class="fas fa-trash"></i> X√≥a
        </button>
      `;
      list.appendChild(item);
    });
  }

  window.deleteProduct = async (key) => {
    if (!confirm('X√≥a s·∫£n ph·∫©m n√†y?')) return;
    await remove(ref(db, `products/${key}`));
  };

  document.getElementById('productForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('productName').value.trim();
    const price = document.getElementById('productPrice').value.trim();
    const category = document.getElementById('productCategory').value;
    const image = document.getElementById('productImage').value.trim();

    if (!name || !price || !category || !image) return alert('ƒêi·ªÅn ƒë·∫ßy ƒë·ªß!');

    await push(ref(db, 'products'), { name, price, category, image });
    e.target.reset();
  });

  function renderEvents(events) {
    const list = document.getElementById('eventList');
    list.innerHTML = '';

    if (events.length === 0) {
      list.innerHTML = '<p class="text-muted text-center py-4">Ch∆∞a c√≥ s·ª± ki·ªán n√†o.</p>';
      return;
    }

    events.forEach(e => {
      const item = document.createElement('div');
      item.className = 'list-group-item d-flex justify-content-between align-items-center';
      item.innerHTML = `
        <div>
          <strong>${e.title}</strong> ‚Äî ${e.date}<br>
          <small class="text-muted">${e.desc.substring(0, 80)}${e.desc.length > 80 ? '...' : ''}</small>
        </div>
        <button class="btn btn-danger btn-sm" onclick="deleteEvent('${e.key}')">
          <i class="fas fa-trash"></i> X√≥a
        </button>
      `;
      list.appendChild(item);
    });
  }

  window.deleteEvent = async (key) => {
    if (!confirm('X√≥a s·ª± ki·ªán n√†y?')) return;
    await remove(ref(db, `events/${key}`));
  };

  document.getElementById('eventForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const title = document.getElementById('eventTitle').value.trim();
    const date = document.getElementById('eventDate').value.trim();
    const desc = document.getElementById('eventDesc').value.trim();
    const image = document.getElementById('eventImage').value.trim() || '';

    if (!title || !date || !desc) return alert('ƒêi·ªÅn ƒë·∫ßy ƒë·ªß!');

    await push(ref(db, 'events'), { title, date, desc, image });
    e.target.reset();
  });

  // Theme & Language (keep your original code here)
  // ... your themeBtn, setTheme, langGroup, setLang, dict, etc.
</script>
</body>
</html>
